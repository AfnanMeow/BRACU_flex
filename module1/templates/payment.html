{% extends "base.html" %}
{% load static %}

{% block content %}
<h2>Complete Your Subscription Payment</h2>
<form id="payment-form">
    <input type="hidden" name="plan_id" value="{{ plan_id }}">
    <button type="submit" id="checkout-button">Pay with Card</button>
</form>
<script src="https://js.stripe.com/v3/"></script>
<script>
document.getElementById('payment-form').addEventListener('submit', function(e) {
    e.preventDefault();
    fetch("{% url 'create_checkout_session' %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: "plan_id={{ plan_id }}"
    })
    .then(response => response.json())
    .then(data => {
        var stripe = Stripe("{{ STRIPE_PUBLIC_KEY }}");
        stripe.redirectToCheckout({ sessionId: data.id });
    });
});
</script>
{% endblock %}
